PYTHON_BUILD_FLAGS = `python-config --include`
CC = gcc $(PYTHON_BUILD_FLAGS) -fpic $(INCL)
SWIG_PYTHON = swig -python -w462

all: _libcommon_py.so libcommon_py.py

COMMONS=../common.h

#the main python package file generated by SWIG from bind.swg
libcommon_py.py: common.swg $(COMMONS)
	$(SWIG_PYTHON) common.swg

#the wrap file generated by SWIG from common.swg
common_wrap.c: common.swg $(COMMONS)
	$(SWIG_PYTHON) common.swg 

#object file made by gcc via compiling of the wrap file
common_wrap.o: common_wrap.c
	$(CC) -c common_wrap.c -o common_wrap.o

#the binary code that is supposed to be loaded by libcommon_py.py
#it has _ in the beginning because libcommon_py.py file expects its existance
_libcommon_py.so: common_wrap.o
	$(CC) -shared common_wrap.o -o _libcommon_py.so

test: all
	python -c "import libcommon_py; print dir(libcommon_py); print 'Ok'"

clean:
	rm -f *.o _libcommon_py.so libcommon_py.py common_wrap.c *.pyc
